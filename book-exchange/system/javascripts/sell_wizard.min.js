(function(a){a(document).ready(function(){var h=new Array();var e=0;var f;var c=a("div.imageContainer");var b=a("input.imageURL");var k=a("span.back");var j=a("span.forward");var g="AIzaSyCCfXsNv47Xg62-Kz6opyvmn3YBPhliZ0k";var d="https://www.googleapis.com/shopping/search/v1/public/products?country=US&key="+g+"&q=";var i="api.php?ISBN=";a("input.ISBN").change(function(){var l=a(this);var m=l.val().replace(/[^0-9]/g,"");if(m.length==10||m.length==13){a.ajax({url:i+m,success:function(q){if(q.toString()!="failure"){q=a.parseJSON(q);var p='<span class="editionInfo"></span>';if(q.edition!=""){p='<span class="editionInfo"><strong>Edition:</strong> '+q.edition+"</span>"}var o="";for(var n=0;n<=q.classes.length-1;n++){o+='<span class="class"><span class="band" style="border-left-color: '+q.classes[n].color+';"><span class="icon" style="background-image: url(\'../../data/book-exchange/icons/'+q.classes[n].id+"/icon_032.png');\">"+q.classes[n].name+" "+q.classes[n].classNum+" "+q.classes[n].section+"</span></span></span>"}f=a('<section class="dialog suggestions"><h1>We Already Have this Book On Record</h1><div class="content"><div class="imagePreview"><p>Verify that the suggested book cover is correct:</p><img src="'+q.imageURL+'"></div><div class="bookInfo"><p>Check the title, author, and edition (if available):</p><span class="titleInfo"><strong>Title:</strong> '+q.title+'</span><span class="authorInfo"><strong>Author:</strong> '+q.author+"</span>"+p+'</div><div class="classInfo"><p>Click on the class or classes where you used this book:</p>'+o+'</div></div><div class="buttons"><button class="green accurate">This Information Is Accurate</button><button class="red inAccurate">This Information Is Not Accurate</button></div></section>').appendTo("body").delfini_dialog();a("div.imageBrowser").addClass("hidden")}else{c.text("Guessing...");h=new Array();k.addClass("disabled");j.removeClass("disabled");a.ajax({url:d+m,dataType:"jsonp",success:function(u){var t=u.items;e=0;if(t&&t!=undefined){for(var s=0;s<=t.length-1;s++){if(t[s].product.images&&t[s].product.images!=undefined){h.push(t[s].product.images[0].link)}}}if((!t&&t==undefined)||(t&&t!=undefined&&t.length==0)){var r=document.location.href.toString().match(/(.*)\/sell-books\//)[1]+"/system/images/icons/default_book.png";c.html('<img src="'+r+'" />');a("input.imageURL").attr("value",r);a("div.imageBrowser").addClass("hidden")}else{c.html('<img src="'+h[0]+'" />');a("input.imageURL").attr("value",h[0]);if(t.length==1){j.addClass("disabled")}a("div.imageBrowser").removeClass("hidden")}}})}}})}});a("body").delegate("section.dialog div.content div.classInfo span.class","click",function(){var l=a(this);if(l.hasClass("selected")){l.removeClass("selected")}else{l.addClass("selected")}});a("body").delegate("section.dialog div.buttons button.accurate","click",function(){var u=a(this).parent().parent();var l=u.children("div.content").children("div.imagePreview").children("img").attr("src");var w=u.children("div.content").children("div.bookInfo").children("span.titleInfo").text();var n=u.children("div.content").children("div.bookInfo").children("span.authorInfo").text();var s=u.children("div.content").children("div.bookInfo").children("span.editionInfo").text();a("input.titleInput").val(w.substring(7,w.length));a("input.authorInput").val(n.substring(8,n.length));a("input.editionInput").val(s.substring(9,s.length));a("div.imageContainer").html('<img src="'+l+'" />');a("input.imageURL").attr("value",l);a("span.titlePreview").text(w.substring(7,w.length));a("span.authorPreview").text(n);if(s!=""){a("span.editionPreview").text(s).show()}else{a("span.editionPreview").hide()}var m=u.children("div.content").children("div.classInfo").children("span.class.selected");var t=new Array();m.each(function(){var x=a(this).text();var y=new Array();y.push(x.substring(0,x.length-6));y.push(x.substring(x.length-5,x.length-2));y.push(x.substring(x.length-1,x.length));t.push(y)});var v=a("div.courseInformationSection");var q=v.children("div.flyoutTemplate").html();var p=v.children("div.sectionTemplate").html();if(m.length>0){v.children("div.classUsed").remove()}for(var o=0;o<=t.length-1;o++){var r=a('<div class="classUsed" />');r.insertAfter(v.children("div:last"));r.append(q);r.append('<div class="inputWrapper"><input autocomplete="off" class="noIcon validate[required,custom[integer],min[101],max[499]]" maxlength="3" name="classNum[]" type="text" value="'+t[o][1]+'" /><div>');r.append(p);r.append('<span class="delete" title="Delete this class"></span>');r.find("div.menuWrapper ul.categoryFly li ul li").each(function(){var x=a(this);if(x.hasClass("selected")){x.removeClass("selected")}if(x.text()==t[o][0]){x.addClass("selected");r.find("div.menuWrapper input").attr("value",x.attr("data-value"))}});r.find("div.dropdownWrapper ul.dropdown li").each(function(){var x=a(this);if(x.hasClass("selected")){x.removeClass("selected")}if(x.text()==t[o][2]){x.addClass("selected")}})}u.delfini_dialog("close")});a("body").delegate("section.dialog div.buttons button.inAccurate","click",function(){var l=d+a("input.ISBN").val();a(this).parent().parent().delfini_dialog("close");a.ajax({url:l,dataType:"jsonp",success:function(o){var n=o.items;e=0;for(var m=0;m<=n.length-1;m++){h.push(n[m].product.images[0].link)}c.html('<img src="'+h[0]+'" />');a("input.imageURL").attr("value",h[0]);a("div.imageBrowser").removeClass("hidden")}})});j.click(function(){if(!j.hasClass("disabled")&&h[e+1]!=undefined){e++;c.html('<img src="'+h[e]+'" />');b.attr("value",h[e]);if(h[e+1]==undefined){j.addClass("disabled")}k.removeClass("disabled")}});k.click(function(){if(!k.hasClass("disabled")&&h[e-1]!=undefined){e--;c.html('<img src="'+h[e]+'" />');b.attr("value",h[e]);if(h[e-1]==undefined){k.addClass("disabled")}j.removeClass("disabled")}});a("input.titleInput").on("change",function(){var l=a(this);if(l.val()==""){a("span.titlePreview").html("&lt;Book Title&gt;")}else{a("span.titlePreview").text(l.val())}});a("input.authorInput").on("change",function(){var l=a(this);if(l.val()==""){a("span.authorPreview").html("Author: &lt;Book Title&gt;")}else{a("span.authorPreview").text("Author: "+l.val())}});a("input.editionInput").on("change",function(){var l=a(this);if(l.val()==""){a("span.editionPreview").text("Edition: ").hide()}else{a("span.editionPreview").text("Edition: "+l.val()).show()}});a("input.priceInput").on("change",function(){var m=a(this);var n=parseInt(m.val().replace(/[^0-9]/g,""));var l=/^\d+(\.\d{2})?$/;if(m.val()!=""&&n>=0&&n<=99999&&l.test(m.val())){a("span.pricePreview span").text("$"+m.val())}else{a("span.pricePreview span").text("$0.00")}});a("body").delegate("span.delete","click",function(){if(a("div.classUsed").length>1){a(this).parent().remove()}else{a('<section class="dialog" style="margin: 0px 35% 0px 35%; width: 30%;"><h1>Whoops!</h1><div class="content"><p style="font-size: 16px; margin-top: 5px;">You must have at least one class in this list.</p></div><div class="buttons"><button class="blue close">Ok, thanks</button></div></section>').appendTo("body").delfini_dialog()}});a("body").delegate("button.close","click",function(){a(this).parent().parent().delfini_dialog("close")});a("span.add").click(function(){var l=a("div.courseInformationSection");var m=l.children("div.flyoutTemplate").html();var o=l.children("div.sectionTemplate").html();var n=a('<div class="classUsed" />');n.insertAfter(l.children("div:last"));n.append(m);n.append('<div class="inputWrapper"><input autocomplete[off] class="noIcon validate[required,custom[integer],min[101],max[499]]" maxlength="3" name="classNum[]" type="text" value="" /><div>');n.append(o);n.append('<span class="delete" title="Delete this class"></span>')});a(":text").tooltip({position:"center right",offset:[-2,10],effect:"fade",opacity:0.7});a("form").validationEngine();a("input.again").click(function(){a("input.redirect").attr("value","1")});a("input.finish").click(function(){a("input.redirect").attr("value","0")});a("input.cancel").click(function(){document.location.href="../"})})})(jQuery);function checkImage(c,d,b,a){if(c.val()==""){return"* You will probably want an image to go with your book"}}function checkISBN(d,e,b,a){var c=d.val().replace(/[^0-9]/g,"");if(c.length==10||c.length==13){}else{return"* An ISBN will have either 10 or 13 numbers, dashes are okay"}}function checkPrice(e,f,c,b){var d=parseInt(e.val().replace(/[^0-9]/g,""));var a=/^\d+(\.\d{2})?$/;if(d>=0&&d<=99999&&a.test(e.val())){}else{return"* Valid prices range from $0.00 to $999.99"}};