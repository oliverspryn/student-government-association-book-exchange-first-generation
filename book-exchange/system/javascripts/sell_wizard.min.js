(function(a){a(document).ready(function(){var i=new Array();var e=0;var f,h;var c=a("div.imageContainer");var b=a("input.imageURL");var l=a("span.back");var k=a("span.forward");var g="AIzaSyCCfXsNv47Xg62-Kz6opyvmn3YBPhliZ0k";var d="https://www.googleapis.com/shopping/search/v1/public/products?country=US&key="+g+"&q=";var j="api.php?ISBN=";a("input.ISBN").change(function(){var m=a(this);var n=m.val().replace(/[^0-9]/g,"");if(n.length==10||n.length==13){a.ajax({url:j+n,success:function(r){if(r.toString()!="failure"){r=a.parseJSON(r);var q='<span class="editionInfo"></span>';if(r.edition!=""){q='<span class="editionInfo"><strong>Edition:</strong> '+r.edition+"</span>"}var p="";for(var o=0;o<=r.classes.length-1;o++){p+='<span class="class"><span class="band" style="border-left-color: '+r.classes[o].color+';"><span class="icon" style="background-image: url(\'../../data/book-exchange/icons/'+r.classes[o].id+"/icon_032.png');\">"+r.classes[o].name+" "+r.classes[o].classNum+" "+r.classes[o].section+"</span></span></span>"}f=a('<section class="dialog suggestions"><h1>We Already Have this Book On Record</h1><div class="content"><div class="imagePreview"><p>Verify that the suggested book cover is correct:</p><img src="'+r.imageURL+'"></div><div class="bookInfo"><p>Check the title, author, and edition (if available):</p><span class="titleInfo"><strong>Title:</strong> '+r.title+'</span><span class="authorInfo"><strong>Author:</strong> '+r.author+"</span>"+q+'</div><div class="classInfo"><p><span class="highlight">Click on the classes</span> where you used this book (you can add more later):</p>'+p+'</div></div><div class="buttons"><button class="green accurate">This Information Is Accurate</button><button class="red inAccurate">This Information Is Not Accurate</button></div></section>').appendTo("body").delfini_dialog();a("div.imageBrowser").addClass("hidden")}else{c.text("Guessing...");i=new Array();l.addClass("disabled");k.removeClass("disabled");a.ajax({url:d+n,dataType:"jsonp",success:function(v){var u=v.items;e=0;if(u&&u!=undefined){for(var t=0;t<=u.length-1;t++){if(u[t].product.images&&u[t].product.images!=undefined){i.push(u[t].product.images[0].link)}}}if((!u&&u==undefined)||(u&&u!=undefined&&u.length==0)){var s=document.location.href.toString().match(/(.*)\/sell-books\//)[1]+"/system/images/icons/default_book.png";c.html('<img src="'+s+'" />');a("input.imageURL").attr("value",s);a("div.imageBrowser").addClass("hidden")}else{c.html('<img src="'+i[0]+'" />');a("input.imageURL").attr("value",i[0]);if(u.length==1){k.addClass("disabled")}a("div.imageBrowser").removeClass("hidden")}}})}}})}});a("body").delegate("section.dialog div.content div.classInfo span.class","click",function(){var m=a(this);if(m.hasClass("selected")){m.removeClass("selected")}else{m.addClass("selected")}});a("body").delegate("section.dialog div.buttons button.accurate","click",function(){var v=a(this).parent().parent();var n=v.children("div.content").children("div.classInfo").children("span.class.selected");var m=v.children("div.content").children("div.imagePreview").children("img").attr("src");var x=v.children("div.content").children("div.bookInfo").children("span.titleInfo").text();var o=v.children("div.content").children("div.bookInfo").children("span.authorInfo").text();var t=v.children("div.content").children("div.bookInfo").children("span.editionInfo").text();a("input.titleInput").val(x.substring(7,x.length));a("input.authorInput").val(o.substring(8,o.length));a("input.editionInput").val(t.substring(9,t.length));a("div.imageContainer").html('<img src="'+m+'" />');a("input.imageURL").attr("value",m);a("span.titlePreview").text(x.substring(7,x.length));a("span.authorPreview").text(o);if(t!=""){a("span.editionPreview").text(t).show()}else{a("span.editionPreview").hide()}var u=new Array();n.each(function(){var y=a(this).text();var z=new Array();z.push(y.substring(0,y.length-6));z.push(y.substring(y.length-5,y.length-2));z.push(y.substring(y.length-1,y.length));u.push(z)});var w=a("div.courseInformationSection");var r=w.children("div.flyoutTemplate").html();var q=w.children("div.sectionTemplate").html();if(n.length>0){w.children("div.classUsed").remove()}for(var p=0;p<=u.length-1;p++){var s=a('<div class="classUsed" />');s.insertAfter(w.children("div:last"));s.append(r);s.append('<div class="inputWrapper"><input autocomplete="off" class="noIcon validate[required,custom[integer],min[101],max[499]]" maxlength="3" name="classNum[]" type="text" value="'+u[p][1]+'" /><div>');s.append(q);s.append('<span class="delete" title="Delete this class"></span>');s.find("div.menuWrapper ul.categoryFly li ul li").each(function(){var y=a(this);if(y.hasClass("selected")){y.removeClass("selected")}if(y.text()==u[p][0]){y.addClass("selected");s.find("div.menuWrapper input").attr("value",y.attr("data-value"))}});s.find("div.dropdownWrapper ul.dropdown li").each(function(){var y=a(this);if(y.hasClass("selected")){y.removeClass("selected")}if(y.text()==u[p][2]){y.addClass("selected")}})}v.delfini_dialog("close")});a("body").delegate("section.dialog div.buttons button.inAccurate","click",function(){var m=d+a("input.ISBN").val();a(this).parent().parent().delfini_dialog("close");a.ajax({url:m,dataType:"jsonp",success:function(p){var o=p.items;e=0;for(var n=0;n<=o.length-1;n++){i.push(o[n].product.images[0].link)}c.html('<img src="'+i[0]+'" />');a("input.imageURL").attr("value",i[0]);a("div.imageBrowser").removeClass("hidden")}})});k.click(function(){if(!k.hasClass("disabled")&&i[e+1]!=undefined){e++;c.html('<img src="'+i[e]+'" />');b.attr("value",i[e]);if(i[e+1]==undefined){k.addClass("disabled")}l.removeClass("disabled")}});l.click(function(){if(!l.hasClass("disabled")&&i[e-1]!=undefined){e--;c.html('<img src="'+i[e]+'" />');b.attr("value",i[e]);if(i[e-1]==undefined){l.addClass("disabled")}k.removeClass("disabled")}});a("input.titleInput").on("change",function(){var m=a(this);if(m.val()==""){a("span.titlePreview").html("&lt;Book Title&gt;")}else{a("span.titlePreview").text(m.val())}});a("input.authorInput").on("change",function(){var m=a(this);if(m.val()==""){a("span.authorPreview").html("Author: &lt;Book Title&gt;")}else{a("span.authorPreview").text("Author: "+m.val())}});a("input.editionInput").on("change",function(){var m=a(this);if(m.val()==""){a("span.editionPreview").text("Edition: ").hide()}else{a("span.editionPreview").text("Edition: "+m.val()).show()}});a("input.priceInput").on("change",function(){var n=a(this);var o=parseInt(n.val().replace(/[^0-9]/g,""));var m=/^\d+(\.\d{2})?$/;if(n.val()!=""&&o>=0&&o<=99999&&m.test(n.val())){a("span.pricePreview span").text("$"+parseFloat(n.val()).toFixed(2));n.attr("value",parseFloat(n.val()).toFixed(2))}else{a("span.pricePreview span").text("$0.00");n.attr("value","0.00")}});a("body").delegate("span.delete","click",function(){if(a("div.classUsed").length>1){a(this).parent().remove()}else{a('<section class="dialog" style="margin: 0px 35% 0px 35%; width: 30%;"><h1>Whoops!</h1><div class="content"><p style="font-size: 16px; margin-top: 5px;">You must have at least one class in this list.</p></div><div class="buttons"><button class="blue close">Ok, thanks</button></div></section>').appendTo("body").delfini_dialog()}});a("body").delegate("button.close","click",function(){a(this).parent().parent().delfini_dialog("close")});a("span.add").click(function(){var m=a("div.courseInformationSection");var n=m.children("div.flyoutTemplate").html();var p=m.children("div.sectionTemplate").html();var o=a('<div class="classUsed" />');o.insertAfter(m.children("div:last"));o.append(n);o.append('<div class="inputWrapper"><input autocomplete[off] class="noIcon validate[required,custom[integer],min[101],max[499]]" maxlength="3" name="classNum[]" type="text" value="" /><div>');o.append(p);o.append('<span class="delete" title="Delete this class"></span>')});a(":text").tooltip({position:"center right",offset:[-2,10],effect:"fade"});a("form").validationEngine({validationEventTrigger:"submit",autoHidePrompt:"true",autoHideDelay:7000});a("input.again").click(function(){a("input.redirect").attr("value","1")});a("input.finish").click(function(){a("input.redirect").attr("value","0")});a("input.cancel").click(function(){document.location.href="../"})})})(jQuery);function checkImage(c,d,b,a){if(c.val()==""){return"* You will probably want an image to go with your book"}}function checkISBN(d,e,b,a){var c=d.val().replace(/[^0-9]/g,"");if(c.length==10||c.length==13){}else{return"* An ISBN will have either 10 or 13 numbers, dashes are okay"}}function checkPrice(e,f,c,b){var d=parseInt(e.val().replace(/[^0-9]/g,""));var a=/^\d+(\.\d{2})?$/;if(d>=0&&d<=99999&&a.test(e.val())){}else{return"* Valid prices range from $0.00 to $999.99"}};