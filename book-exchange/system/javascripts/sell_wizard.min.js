(function(a){a(document).ready(function(){var i=new Array();var e=0;var f,h,k;var c=a("div.imageContainer");var b=a("input.imageURL");var m=a("span.back");var l=a("span.forward");var g="AIzaSyCCfXsNv47Xg62-Kz6opyvmn3YBPhliZ0k";var d="https://www.googleapis.com/shopping/search/v1/public/products?country=US&key="+g+"&q=";var j="../system/server/suggest_local.php?ISBN=";a("input.ISBN").change(function(){var n=a(this);var o=n.val().replace(/[^0-9a-zA-Z]/g,"");if(o.length==10||o.length==13){a.ajax({url:j+o,success:function(s){a("input.imageID").attr("value","");if(s.toString()!="failure"){s=a.parseJSON(s);var r='<span class="editionInfo"></span>';if(s.edition!=""){r='<span class="editionInfo"><strong>Edition:</strong> '+s.edition+"</span>"}var q="";for(var p=0;p<=s.classes.length-1;p++){q+='<span class="class"><span class="band" style="border-left-color: '+s.classes[p].color+';"><span class="icon" style="background-image: url(\'../../data/book-exchange/icons/'+s.classes[p].id+"/icon_032.png');\">"+s.classes[p].name+" "+s.classes[p].classNum+" "+s.classes[p].section+"</span></span></span>"}f=a('<section class="dialog suggestions"><h1>We Already Have this Book On Record</h1><div class="content"><div class="imagePreview"><p>Verify that the suggested book cover is correct:</p><img src="'+s.imageURL+'"><span class="imageID" style="display: none;"">'+s.imageID+'</span></div><div class="bookInfo"><p>Check the title, author, and edition (if available):</p><span class="titleInfo"><strong>Title:</strong> '+s.title+'</span><span class="authorInfo"><strong>Author:</strong> '+s.author+"</span>"+r+'</div><div class="classInfo"><p><span class="highlight">Click on the classes</span> where you used this book (you can add more later):</p>'+q+'</div></div><div class="buttons"><button class="green accurate">This Information Is Accurate</button><button class="red inAccurate">This Information Is Not Accurate</button></div></section>').appendTo("body").delfini_dialog();a("div.imageBrowser").addClass("hidden")}else{c.text("Guessing...");i=new Array();m.addClass("disabled");l.removeClass("disabled");a.ajax({url:d+o,dataType:"jsonp",success:function(w){var v=w.items;e=0;if(v&&v!=undefined){for(var u=0;u<=v.length-1;u++){if(v[u].product.images&&v[u].product.images!=undefined){i.push(v[u].product.images[0].link)}}}if((!v&&v==undefined)||(v&&v!=undefined&&v.length==0)){var t=document.location.href.toString().match(/(.*)\/sell-books\//)[1]+"/system/images/icons/default_book.png";c.html('<img src="'+t+'" />');a("input.imageURL").attr("value",t);a("div.imageBrowser").addClass("hidden");k=a('<section class="dialog checkISBN" style="margin: 0px 30% 0px 30%; width: 40%;"><h1>Whoops!</h1><div class="content"><p style="font-size: 16px; margin-top: 5px;">We were unable to find a cover to match the ISBN you entered. This is usually because it was entered incorrectly. Check it again to see if you typed it in correctly.<br><br>If you did enter it in correctly, this may be a rare case where we cannot match the ISBN to a book cover.</p></div><div class="buttons"><button class="blue close">Ok, thanks</button></div></section>').appendTo("body").delfini_dialog()}else{c.html('<img src="'+i[0]+'" />');a("input.imageURL").attr("value",i[0]);if(v.length==1){l.addClass("disabled")}a("div.imageBrowser").removeClass("hidden");if(i.length>1){setTimeout(function(){a("div.imageBrowser span.forward").validationEngine("showPrompt","Click on these arrows to browse through the images and find the best looking cover!","pass","topRight",true)},4000)}}}})}}})}else{if(o!=""){k=a('<section class="dialog checkISBN" style="margin: 0px 30% 0px 30%; width: 40%;"><h1>Whoops!</h1><div class="content"><p style="font-size: 16px; margin-top: 5px;"><strong>'+n.val()+'</strong> doesn\'t look like an ISBN. Check it again to see if you entered it correctly.</p></div><div class="buttons"><button class="blue close">Ok, thanks</button></div></section>').appendTo("body").delfini_dialog()}}});a("body").delegate("section.checkISBN div.buttons button.close","click",function(){a(this).parent().parent().delfini_dialog("close")});a("body").delegate("section.dialog div.content div.classInfo span.class","click",function(){var n=a(this);if(n.hasClass("selected")){n.removeClass("selected")}else{n.addClass("selected")}});a("body").delegate("section.dialog div.buttons button.accurate","click",function(){var z=a(this).parent().parent();var q=z.children("div.content").children("div.classInfo").children("span.class.selected");var p=z.children("div.content").children("div.imagePreview").children("img").attr("src");var x=z.children("div.content").children("div.imagePreview").children("span.imageID").text();var B=z.children("div.content").children("div.bookInfo").children("span.titleInfo").text();var y=z.children("div.content").children("div.bookInfo").children("span.authorInfo").html();var u=z.children("div.content").children("div.bookInfo").children("span.authorInfo").text();var o=z.children("div.content").children("div.bookInfo").children("span.editionInfo").html();var n=z.children("div.content").children("div.bookInfo").children("span.editionInfo").text();a("input.titleInput").val(B.substring(7,B.length));a("input.authorInput").val(u.substring(8,u.length));a("input.editionInput").val(n.substring(9,n.length));a("div.imageContainer").html('<img src="'+p+'" />');a("input.imageURL").attr("value",p);a("input.imageID").attr("value",x);a("span.titlePreview").text(B.substring(7,B.length));a("span.authorPreview").html(y);if(n!=""){a("span.editionPreview").html(o).show()}else{a("span.editionPreview").hide()}var w=new Array();q.each(function(){var C=a(this).text();var D=new Array();D.push(C.substring(0,C.length-6));D.push(C.substring(C.length-5,C.length-2));D.push(C.substring(C.length-1,C.length));w.push(D)});var A=a("section.courseInformationSection");var t=A.children("div.flyoutTemplate").html();var s=A.children("div.sectionTemplate").html();if(q.length>0){A.children("div.classUsed").remove()}for(var r=0;r<=w.length-1;r++){var v=a('<div class="classUsed" />');v.insertAfter(A.children("div:last"));v.append(t);v.append('<div class="inputWrapper"><input autocomplete="off" class="noIcon validate[required,custom[integer],min[101],max[499]]" maxlength="3" name="classNum[]" type="text" value="'+w[r][1]+'" /><div>');v.append(s);v.append('<span class="delete" title="Delete this class"></span>');v.find("div.menuWrapper ul.categoryFly li ul li").each(function(){var C=a(this);if(C.hasClass("selected")){C.removeClass("selected")}if(C.text()==w[r][0]){C.addClass("selected");v.find("div.menuWrapper input").attr("value",C.attr("data-value"))}});v.find("div.dropdownWrapper ul.dropdown li").each(function(){var C=a(this);if(C.hasClass("selected")){C.removeClass("selected")}if(C.text()==w[r][2]){C.addClass("selected");v.find("div.dropdownWrapper input").attr("value",C.text())}})}z.delfini_dialog("close")});a("body").delegate("section.dialog div.buttons button.inAccurate","click",function(){var n=d+a("input.ISBN").val();a(this).parent().parent().delfini_dialog("close");c.text("Guessing...");i=new Array();m.addClass("disabled");l.removeClass("disabled");a.ajax({url:n,dataType:"jsonp",success:function(r){var q=r.items;e=0;if(q&&q!=undefined){for(var p=0;p<=q.length-1;p++){if(q[p].product.images&&q[p].product.images!=undefined){i.push(q[p].product.images[0].link)}}}if((!q&&q==undefined)||(q&&q!=undefined&&q.length==0)){var o=document.location.href.toString().match(/(.*)\/sell-books\//)[1]+"/system/images/icons/default_book.png";c.html('<img src="'+o+'" />');a("input.imageURL").attr("value",o);a("div.imageBrowser").addClass("hidden")}else{c.html('<img src="'+i[0]+'" />');a("input.imageURL").attr("value",i[0]);if(q.length==1){l.addClass("disabled")}a("div.imageBrowser").removeClass("hidden");if(i.length>1){setTimeout(function(){a("div.imageBrowser span.forward").validationEngine("showPrompt","Click on these arrows to browse through the images and find the best looking cover!","pass","topRight",true)},4000)}}}})});l.click(function(){if(!l.hasClass("disabled")&&i[e+1]!=undefined){e++;c.html('<img src="'+i[e]+'" />');b.attr("value",i[e]);if(i[e+1]==undefined){l.addClass("disabled")}m.removeClass("disabled")}});m.click(function(){if(!m.hasClass("disabled")&&i[e-1]!=undefined){e--;c.html('<img src="'+i[e]+'" />');b.attr("value",i[e]);if(i[e-1]==undefined){m.addClass("disabled")}l.removeClass("disabled")}});a("input.titleInput").on("change",function(){var n=a(this);if(n.val()==""){a("span.titlePreview").html("&lt;Book Title&gt;")}else{a("span.titlePreview").text(n.val())}});a("input.authorInput").on("change",function(){var n=a(this);if(n.val()==""){a("span.authorPreview").html("<strong>Author:</strong> &lt;Book Title&gt;")}else{a("span.authorPreview").html("<strong>Author:</strong> "+n.val())}});a("input.editionInput").on("change",function(){var n=a(this);if(n.val()==""){a("span.editionPreview").html("<strong>Edition:</strong> ").hide()}else{a("span.editionPreview").html("<strong>Edition:</strong> "+n.val()).show()}});a("input.priceInput").on("change",function(){var n=a(this);var o=parseInt(n.val().replace(/[^0-9]/g,""));if(n.val()!=""&&o>=0&&o<=99999){a("span.pricePreview span").text("$"+parseFloat(n.val()).toFixed(2));n.attr("value",parseFloat(n.val()).toFixed(2))}else{a("span.pricePreview span").text("$0.00");n.attr("value","0.00")}});a("body").delegate("span.delete","click",function(){if(a("div.classUsed").length>1){a(this).parent().remove()}else{a('<section class="dialog" style="margin: 0px 35% 0px 35%; width: 30%;"><h1>Whoops!</h1><div class="content"><p style="font-size: 16px; margin-top: 5px;">You must have at least one class in this list.</p></div><div class="buttons"><button class="blue close">Ok, thanks</button></div></section>').appendTo("body").delfini_dialog()}});a("body").delegate("button.close","click",function(){a(this).parent().parent().delfini_dialog("close")});a("span.add").click(function(){var n=a("section.courseInformationSection");var o=n.children("div.flyoutTemplate").html();var q=n.children("div.sectionTemplate").html();var p=a('<div class="classUsed" />');p.insertAfter(n.children("div:last"));p.append(o);p.append('<div class="inputWrapper"><input autocomplete="off" class="noIcon validate[required,custom[integer],min[101],max[499]]" maxlength="3" name="classNum[]" type="text" value="" /><div>');p.append(q);p.append('<span class="delete" title="Delete this class"></span>')});a(":text").tooltip({position:"center right",offset:[-2,10],effect:"fade"});a("form").validationEngine({validationEventTrigger:"submit",promptPosition:"topRight",autoHidePrompt:"true",autoHideDelay:7000});a("input.again").click(function(){a("input.redirect").attr("value","1")});a("input.finish").click(function(){a("input.redirect").attr("value","0")});a("input.cancel").click(function(){document.location.href="../"})})})(jQuery);function checkImage(c,d,b,a){if(c.val()==""){return"* You will probably want an image to go with your book"}}function checkISBN(d,e,b,a){var c=d.val().replace(/[^0-9a-zA-Z]/g,"");if(c.length==10||c.length==13){}else{return"* An ISBN will have either 10 or 13 numbers, dashes are okay"}}function checkPrice(e,f,c,b){var d=parseInt(e.val().replace(/[^0-9]/g,""));var a=/^\d+(\.\d{2})?$/;if(d>=0&&d<=99999&&a.test(e.val())){}else{return"* Valid prices range from $0.00 to $999.99"}};