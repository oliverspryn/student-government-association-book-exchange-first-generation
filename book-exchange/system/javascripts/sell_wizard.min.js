(function(a){a(document).ready(function(){var i=new Array();var e=0;var f,h,k;var c=a("div.imageContainer");var b=a("input.imageURL");var m=a("span.back");var l=a("span.forward");var g="AIzaSyCCfXsNv47Xg62-Kz6opyvmn3YBPhliZ0k";var d="https://www.googleapis.com/shopping/search/v1/public/products?country=US&key="+g+"&q=";var j="api.php?ISBN=";a("input.ISBN").change(function(){var n=a(this);var o=n.val().replace(/[^0-9a-zA-Z]/g,"");if(o.length==10||o.length==13){a.ajax({url:j+o,success:function(s){if(s.toString()!="failure"){s=a.parseJSON(s);var r='<span class="editionInfo"></span>';if(s.edition!=""){r='<span class="editionInfo"><strong>Edition:</strong> '+s.edition+"</span>"}var q="";for(var p=0;p<=s.classes.length-1;p++){q+='<span class="class"><span class="band" style="border-left-color: '+s.classes[p].color+';"><span class="icon" style="background-image: url(\'../../data/book-exchange/icons/'+s.classes[p].id+"/icon_032.png');\">"+s.classes[p].name+" "+s.classes[p].classNum+" "+s.classes[p].section+"</span></span></span>"}f=a('<section class="dialog suggestions"><h1>We Already Have this Book On Record</h1><div class="content"><div class="imagePreview"><p>Verify that the suggested book cover is correct:</p><img src="'+s.imageURL+'"></div><div class="bookInfo"><p>Check the title, author, and edition (if available):</p><span class="titleInfo"><strong>Title:</strong> '+s.title+'</span><span class="authorInfo"><strong>Author:</strong> '+s.author+"</span>"+r+'</div><div class="classInfo"><p><span class="highlight">Click on the classes</span> where you used this book (you can add more later):</p>'+q+'</div></div><div class="buttons"><button class="green accurate">This Information Is Accurate</button><button class="red inAccurate">This Information Is Not Accurate</button></div></section>').appendTo("body").delfini_dialog();a("div.imageBrowser").addClass("hidden")}else{c.text("Guessing...");i=new Array();m.addClass("disabled");l.removeClass("disabled");a.ajax({url:d+o,dataType:"jsonp",success:function(w){var v=w.items;e=0;if(v&&v!=undefined){for(var u=0;u<=v.length-1;u++){if(v[u].product.images&&v[u].product.images!=undefined){i.push(v[u].product.images[0].link)}}}if((!v&&v==undefined)||(v&&v!=undefined&&v.length==0)){var t=document.location.href.toString().match(/(.*)\/sell-books\//)[1]+"/system/images/icons/default_book.png";c.html('<img src="'+t+'" />');a("input.imageURL").attr("value",t);a("div.imageBrowser").addClass("hidden")}else{c.html('<img src="'+i[0]+'" />');a("input.imageURL").attr("value",i[0]);if(v.length==1){l.addClass("disabled")}a("div.imageBrowser").removeClass("hidden");setTimeout(function(){a("div.imageBrowser span.forward").validationEngine("showPrompt","Click on these arrows to browse through the images and find the best looking cover!","load","topRight",true)},2000)}}})}}})}else{if(o!=""){k=a('<section class="dialog checkISBN" style="margin: 0px 30% 0px 30%; width: 40%;"><h1>Whoops!</h1><div class="content"><p style="font-size: 16px; margin-top: 5px;"><strong>'+n.val()+'</strong> doesn\'t look like an ISBN. Check it again to see if you entered it correctly.</p></div><div class="buttons"><button class="blue close">Ok, thanks</button></div></section>').appendTo("body").delfini_dialog()}}});a("body").delegate("section.checkISBN div.buttons button.close","click",function(){a(this).parent().parent().delfini_dialog("close")});a("body").delegate("section.dialog div.content div.classInfo span.class","click",function(){var n=a(this);if(n.hasClass("selected")){n.removeClass("selected")}else{n.addClass("selected")}});a("body").delegate("section.dialog div.buttons button.accurate","click",function(){var w=a(this).parent().parent();var o=w.children("div.content").children("div.classInfo").children("span.class.selected");var n=w.children("div.content").children("div.imagePreview").children("img").attr("src");var y=w.children("div.content").children("div.bookInfo").children("span.titleInfo").text();var p=w.children("div.content").children("div.bookInfo").children("span.authorInfo").text();var u=w.children("div.content").children("div.bookInfo").children("span.editionInfo").text();a("input.titleInput").val(y.substring(7,y.length));a("input.authorInput").val(p.substring(8,p.length));a("input.editionInput").val(u.substring(9,u.length));a("div.imageContainer").html('<img src="'+n+'" />');a("input.imageURL").attr("value",n);a("span.titlePreview").text(y.substring(7,y.length));a("span.authorPreview").text(p);if(u!=""){a("span.editionPreview").text(u).show()}else{a("span.editionPreview").hide()}var v=new Array();o.each(function(){var z=a(this).text();var A=new Array();A.push(z.substring(0,z.length-6));A.push(z.substring(z.length-5,z.length-2));A.push(z.substring(z.length-1,z.length));v.push(A)});var x=a("div.courseInformationSection");var s=x.children("div.flyoutTemplate").html();var r=x.children("div.sectionTemplate").html();if(o.length>0){x.children("div.classUsed").remove()}for(var q=0;q<=v.length-1;q++){var t=a('<div class="classUsed" />');t.insertAfter(x.children("div:last"));t.append(s);t.append('<div class="inputWrapper"><input autocomplete="off" class="noIcon validate[required,custom[integer],min[101],max[499]]" maxlength="3" name="classNum[]" type="text" value="'+v[q][1]+'" /><div>');t.append(r);t.append('<span class="delete" title="Delete this class"></span>');t.find("div.menuWrapper ul.categoryFly li ul li").each(function(){var z=a(this);if(z.hasClass("selected")){z.removeClass("selected")}if(z.text()==v[q][0]){z.addClass("selected");t.find("div.menuWrapper input").attr("value",z.attr("data-value"))}});t.find("div.dropdownWrapper ul.dropdown li").each(function(){var z=a(this);if(z.hasClass("selected")){z.removeClass("selected")}if(z.text()==v[q][2]){z.addClass("selected");t.find("div.dropdownWrapper input").attr("value",z.text())}})}w.delfini_dialog("close")});a("body").delegate("section.dialog div.buttons button.inAccurate","click",function(){var n=d+a("input.ISBN").val();a(this).parent().parent().delfini_dialog("close");a.ajax({url:n,dataType:"jsonp",success:function(q){var p=q.items;e=0;for(var o=0;o<=p.length-1;o++){i.push(p[o].product.images[0].link)}c.html('<img src="'+i[0]+'" />');a("input.imageURL").attr("value",i[0]);a("div.imageBrowser").removeClass("hidden")}})});l.click(function(){if(!l.hasClass("disabled")&&i[e+1]!=undefined){e++;c.html('<img src="'+i[e]+'" />');b.attr("value",i[e]);if(i[e+1]==undefined){l.addClass("disabled")}m.removeClass("disabled")}});m.click(function(){if(!m.hasClass("disabled")&&i[e-1]!=undefined){e--;c.html('<img src="'+i[e]+'" />');b.attr("value",i[e]);if(i[e-1]==undefined){m.addClass("disabled")}l.removeClass("disabled")}});a("input.titleInput").on("change",function(){var n=a(this);if(n.val()==""){a("span.titlePreview").html("&lt;Book Title&gt;")}else{a("span.titlePreview").text(n.val())}});a("input.authorInput").on("change",function(){var n=a(this);if(n.val()==""){a("span.authorPreview").html("Author: &lt;Book Title&gt;")}else{a("span.authorPreview").text("Author: "+n.val())}});a("input.editionInput").on("change",function(){var n=a(this);if(n.val()==""){a("span.editionPreview").text("Edition: ").hide()}else{a("span.editionPreview").text("Edition: "+n.val()).show()}});a("input.priceInput").on("change",function(){var o=a(this);var p=parseInt(o.val().replace(/[^0-9]/g,""));var n=/^\d+(\.\d{2})?$/;if(o.val()!=""&&p>=0&&p<=99999&&n.test(o.val())){a("span.pricePreview span").text("$"+parseFloat(o.val()).toFixed(2));o.attr("value",parseFloat(o.val()).toFixed(2))}else{a("span.pricePreview span").text("$0.00");o.attr("value","0.00")}});a("body").delegate("span.delete","click",function(){if(a("div.classUsed").length>1){a(this).parent().remove()}else{a('<section class="dialog" style="margin: 0px 35% 0px 35%; width: 30%;"><h1>Whoops!</h1><div class="content"><p style="font-size: 16px; margin-top: 5px;">You must have at least one class in this list.</p></div><div class="buttons"><button class="blue close">Ok, thanks</button></div></section>').appendTo("body").delfini_dialog()}});a("body").delegate("button.close","click",function(){a(this).parent().parent().delfini_dialog("close")});a("span.add").click(function(){var n=a("div.courseInformationSection");var o=n.children("div.flyoutTemplate").html();var q=n.children("div.sectionTemplate").html();var p=a('<div class="classUsed" />');p.insertAfter(n.children("div:last"));p.append(o);p.append('<div class="inputWrapper"><input autocomplete[off] class="noIcon validate[required,custom[integer],min[101],max[499]]" maxlength="3" name="classNum[]" type="text" value="" /><div>');p.append(q);p.append('<span class="delete" title="Delete this class"></span>')});a(":text").tooltip({position:"center right",offset:[-2,10],effect:"fade"});a("form").validationEngine({validationEventTrigger:"submit",promptPosition:"topRight",autoHidePrompt:"true",autoHideDelay:7000});a("input.again").click(function(){a("input.redirect").attr("value","1")});a("input.finish").click(function(){a("input.redirect").attr("value","0")});a("input.cancel").click(function(){document.location.href="../"})})})(jQuery);function checkImage(c,d,b,a){if(c.val()==""){return"* You will probably want an image to go with your book"}}function checkISBN(d,e,b,a){var c=d.val().replace(/[^0-9a-zA-Z]/g,"");if(c.length==10||c.length==13){}else{return"* An ISBN will have either 10 or 13 numbers, dashes are okay"}}function checkPrice(e,f,c,b){var d=parseInt(e.val().replace(/[^0-9]/g,""));var a=/^\d+(\.\d{2})?$/;if(d>=0&&d<=99999&&a.test(e.val())){}else{return"* Valid prices range from $0.00 to $999.99"}};